# file: vars/specifications/0.8.1/roles.yml
---
roles_specifications:
  metadata:
    non_collection_keys: ['Base', 'metadata']
    role_template_path: "roles/meta_role/templates"
    default_sections:
      - file_header
    collections:
      Meta:        
        description: Roles that coordinate, generate, update or modify the states
          of specifications, playbooks, roles, tests, templates, and rendered content.
        tools:
          update_rendered_section:
            description: "Script targets and updates a specified section from a newly
              rerendered \nversion of the file.\nIt identifies and extracts the updated
              content of the specified section\nfrom the rerendered file and replaces
              the corresponding section's content\nin the target file. \nThe file_header
              section will add the --- if not found or\nupdate anything above the file_header
              delimiter.\nUsage <FILE_TO_UPDATE> <RENDERED_TEMPLATE> <SECTION_NAME>\n"
            path: plugins/scripts/update_rendered_section.sh
          embed_template_fragment:
            description: "Script embeds a specified fragment into a template\nprior
              to rendering, enabling dynamic composition of templates\nfrom modular
              parts.\nUsage takes arguments <SRC_FILE> <DEST_FILE> <FRAGMENT_IDENTIFIER>\n
              [--after=<EXISTING_REGION_IDENTIFIER> |\n --before=<EXISTING_REGION_IDENTIFIER>]
              \n[--region=<NEW_REGION_IDENTIFIER>]\n"
            path: plugins/scripts/embed_template_fragment.sh
      Storage:        
        description: |
          Roles that coordinate, provision or manage storage volumes, encryption,
          mounts, btrfs subvolumes and snapshots.
      Network:
        description: |
          Configure OVS networks, firewalls, and other network services

  Network:
    openvswitch:      
      role_name: openvswitch
      role_path: roles/openvswitch
      files:
        - id: ovs_configured_task
          path: tasks/configured.yml
          template: tasks/base.yml.j2
          state: updated
        - id: ovs_started_task
          path: tasks/started.yml
          template: tasks/base.yml.j2
          state: updated
        - id: ovs_stopped_task
          path: tasks/stopped.yml
          template: tasks/base.yml.j2
          state: updated
      parameters:
        bridges: {}
    ovs_bridge:
      role_name: ovs_bridge
      role_path: roles/ovs_bridge
      paramters:
        name: {}
        ports: {}

  Container:
    container:
      role_name: container
      role_path: roles/container
      parameters:
        name: {}
      
    qemu_runtime:
      role_name: qemu_runtime
      role_path: roles/qemu_runtime
      parameters:
        machine_name: {}
        device_path: {}
        memory: {}
        cpu_cores: {}
        sockets: {}
        smp: {}
        vga: {}
        spice_socket: {}
        port_forwarding: {}
        extras: {}
      defaults:
        qemu_runtime_memory: "4G"
        qemu_runtime_cpu_cores: 4
        qemu_runtime_sockets: 1
        qemu_runtime_smp: "8,threads=2"
        qemu_runtime_vga: "qxl"
        qemu_runtime_spice_socket: "/run/vm_spice.socket"
        qemu_runtime_port_forwarding: ""
        qemu_runtime_extras: ""
    nspawn_runtime:
      role_name: nspawn_runtime
      role_path: roles/nspawn_runtime
      parameters:
        target: {}
        name: {}
        overlays: {}
        extras: {}
      defaults:
        nspawn_runtime_target: "/"
        nspawn_runtime_name: "ephemeral_host"
        nspawn_runtime_overlays: ["/etc::/etc","/root::/root"]
        nspawn_runtime_extras: ["--user=root", "/bin/zsh"]

  Storage:
    loop_device:
      role_name: loop_device
      role_path: roles/loop_device
      parameters:
        target: {}
        map_name: {}
        size: {}
      files:
        - path: tasks/active.yml
          template: tasks/base.yml.j2
          state: updated
        - path: tasks/inactive.yml      
          template: tasks/base.yml.j2
          state: updated
    storage:
      role_name: storage
      role_path: roles/storage
      parameters:
        loop_devoce: {}
        device: {}
        luks: {}
        mount_table: {}
        btrfs_subvolumes: {}
        partition_table: {}
        filesystem: {}
      files:
        - id: mounted_morphism
          path: tasks/mounted.yml
          template: tasks/base.yml.j2
          state: present
        - id: unmounted_morphism
          path: tasks/unmounted.yml
          template: tasks/base.yml.j2
          state: present
        - id: opened_morphism
          path: tasks/opened.yml
          template: tasks/base.yml.j2
          state: present
        - id: closed_morphism
          path: tasks/closed.yml
          template: tasks/base.yml.j2
          state: present
    partition:
      role_name: partition
      role_path: roles/partition
      parameters:
        device: {}
        label: {}
        name: {}
        number: {}
        start: {}
        end: {}
        flags: {}
      defaults:
        partition_flags: []
    luks:
      role_name: luks
      role_path: roles/luks
      files:
        - id: opened_morphism
          path: tasks/opened.yml
          template: tasks/base.yml.j2
          state: present
        - id: closed_morphism
          path: tasks/closed.yml
          template: tasks/base.yml.j2
          state: present
      parameters:
        name: {}
        path: {}
        label: {}
        keyfile: {}
        new_keyfile: {}
        passphrase: {}
        new_passphrase: {}
        mapped_name: {}
        uuid: {}
      defaults:
        luks_key_size: 2048
        luks_type: luks2
        luks_cipher: aes-xts-plain64
        luks_hash: sha512
        luks_pbkdf_algorithm: pbkdf2
        luks_pbkdf_iteration_time: 3
    filesystem:
      role_name: filesystem
      role_path: roles/filesystem
      parameters:
        label: {}
        opts: {}
        type: {}
        path: {}
    btrfs_subvolumes:
      role_name: btrfs_subvolumes
      role_path: roles/btrfs_subvolumes
      parameters:
        subvols: {}
        fs_label: {}
        fs_uuid: {}

    mount:
      role_name: mount
      role_path: roles/mount
      files:
        - id: mounted_morphism
          path: tasks/mounted.yml
          template: tasks/base.yml.j2
          state: present
        - id: unmounted_morphism
          path: tasks/unmounted.yml
          template: tasks/base.yml.j2
          state: present
      parameters:
        map: {}
        type: {}
        target: {}
        source: {}
        fstab: {}
      defaults:
        mount_fstab: "/etc/fstab"

  Base:
    parameters:
      state: {}
    defaults:
      directory_mode: '0770'
      file_mode: '0660'
    directories:
      - path: tasks
      - path: defaults
    files:
      - id: main_task
        path: tasks/main.yml
        metadata:
          auto_generated: true
          warning: Do not edit this file manually. It is automatically generated.
        sections: []
        template: tasks/main.yml.j2
        state: pristine
      - id: info_task
        path: tasks/info.yml
        state: updated
        metadata:
          auto_include:
            - path: info.pre.yml
              type: task
        template: tasks/base.yml.j2
      - id: info_task_managed_include
        state: pristine
        path: tasks/info.pre.yml
        template: tasks/info.pre.yml.j2
        metadata:
          auto_generated: true
          warning: Do not edit this file manually. It is automatically generated.
      - id: present_task
        state: updated
        path: tasks/present.yml
        template: tasks/base.yml.j2
      - id: absent_task
        state: updated
        path: tasks/absent.yml
        template: tasks/base.yml.j2
      - id: defaults_file
        state: pristine
        metadata:
          auto_generated: true
          warning: "Currently set to pristine"
        path: defaults/main.yml
        template: defaults/main.yml.j2
        sections:
          - file_header
          - 31_managed_defaults
  Meta:
    meta_role:
      role_name: meta_role
      role_path: roles/meta_role
      parameters:
        metadata: {}
        specification: {}
      defaults:
        meta_role_metadata:
          role_template_path: "roles/meta_role/templates"
          non_collection_keys: ['Base', 'metadata']
          default_sections: ['file_header']
    meta_template:
      role_name: meta_template
      role_path: roles/meta_template
      parameters:
        specification: {}
        metadata: {}
      files:
        - id: fragment_template
          path: templates/fragment.j2
        - id: skeleton_template
          path: templates/skeleton.j2
    meta_orchestrator:
      role_name: meta_orchestrator
      role_path: roles/meta_orchestrator
      parameters:
        base_path: {}
        check_mode: {}
        specifications_path: {}
        specifications_version: {}
        specifications_map: {}
        specifications: {}
        schema: {}
        operations: "[process_specifications, process_templates, process_roles,  process_playbooks]"
        scope: "all, schema, params"
      defaults:
        meta_orchestrator_specifications_path: "vars/specifications"
        meta_orchestrator_specifications_version: "latest"
        meta_orchestrator_scope: all
        meta_orchestrator_specifications_map:
          metadata: metadata
          roles_specifications: roles
          playbooks_specifications: playbooks
          templates_specifications: templates
          tests_specifications: tests
        meta_orchestrator_schema:
          metadata: {}
          roles:
            Meta: {}
            Storage: {}
          playbooks:
            Meta: {}
          templates:
            Roles: {}
            Playbooks: {}
        meta_orchestrator_operations:
          - process_templates
          - process_roles
          - process_playbooks
    meta_playbook:
      role_name: meta_playbook
      role_path: roles/meta_playbook
      defaults:
        meta_playbook_metadata:
          default_sections: ['file_header']
          non_collection_keys: ['Base', 'metadata']
        meta_playbook_collection_metadata:
          collection_name: Default
          description: Playbooks not in a collection
          path: playbooks/Default
          template_path: playbooks/base.yml.j2
      parameters:
        metadata: {}
        specification: {}
        collection_metadata: {}
